CXX	= g++
CFLAGS = -g -fPIC
CXXFLAGS = -g -fPIC
OFLAG = -o
LDL = -ldl

# paths
SRC_PATH = src
INCLUDE_PATH = include
BUILD_PATH = build
BIN_PATH = $(BUILD_PATH)/bin
BIN_NAME = main

# extension
SRC = cpp
HDR = h

# code lists
# flags
COMPILE_FLAGS = -std=c++11 -Wall -Wextra -g
INCLUDES = -I include/ -I /usr/local/include

.PHONY: release
release: dirs
	@$(MAKE) all

.PHONY: dirs
dirs:
	@echo "Creating directories..."
	@mkdir -p $(dir $(OBJECTS))
	@mkdir -p $(BIN_PATH)

.PHONY: clean
clean:
	@echo "Deleting $(BIN_NAME) symlink..."
	@rm $(BIN_NAME)
	@echo "Deleting directories..."
	@rm -r $(BUILD_PATH)
	@rm -r $(BIN_PATH)

build: $(SOURCE)
	$(CXX) -o main main.o -L. -lshared

main: tests
	$(CXX) -c Main.cpp

tests: matrix
	cd UnitTests && $(CXX) -c TestMatrix.h TestMatrix.cpp -o TestMatrix

matrix: Matrix.cpp Matrix.h
	$(CXX) -c Matrix.cpp Matrix.h

libmatrix.so: Matrix.h Matrix.cpp
	$(CXX) -fPIC -c -shared Matrix.cpp -o Matrix.o
	$(CXX) -shared -Wl, -soname, libmatrix.so -o libmatrix.o Matrix.o
